["Results", "Extending the substitution rate ratio framework to convergence", "One of the most commonly accepted measures of the rate of protein evolution compared with completely unconstrained expectations is the ratio between non-synonymous and synonymous substitution rates, denoted as dN and dS, respectively16. In a model-based framework, the ratio dN/dS is parameterized as \u03c9.", "Inspired by \u03c9, we developed a similar metric, \u03c9C, that applies to substitutions that occurred repeatedly on a combination of separate phylogenetic branches (combinatorial substitutions; Supplementary Fig. 1c and Supplementary Text 2). The metric \u03c9C estimates the relative rates of convergence obtained by contrasting the rates of non-synonymous and synonymous convergence (dNC and dSC, respectively). Using this ratio, important biological fluctuations, such as among-site rate heterogeneity and codon equilibrium frequencies, are taken into account (Supplementary Text 3 and Methods). Note that in neutrally evolving genes, the theoretical expectation of \u03c9C is 1.0, even if \u03c9 in the underlying codon substitution matrix is not 1.0 (usually lower). Similar to previously proposed convergence metrics13,17,18, \u03c9C is calculated from substitutions at multiple codon sites across protein-coding sequences. As a result, one \u03c9C value is obtained for each gene for each branch pair (or for a combination of more than two branches) in the phylogenetic tree. A unique feature of \u03c9C setting it apart from other metrics is its error tolerance. For example, if one of the branches in a branch combination is in error, \u03c9C is a measure of the ratio of false convergence events of both kinds falsely attributed to a non-existent branch combination. In this way, the \u03c9C values remain close to the neutral expectation of 1.0, even when topology errors are involved. Our method is implemented in the Python programme CSUBST (https://github.com/kfuku52/csubst), which takes as input a rooted phylogenetic tree and a codon sequence alignment (Fig. 1b and Supplementary Fig. 2).", "The robustness of \u03c9C in simulated molecular evolution", "Conventionally, observed levels of convergent amino acid substitutions have been contrasted either to the amount of convergence expected under a substitution model (e.g., the convergence measure R18) or to other combinations of amino acid substitution patterns that are similarly affected by site-specific constraint (that is, double divergence; C/D (refs. 13,17)) (Supplementary Table 1 and Supplementary Text 4). Here we focus on whether \u03c9C performs better as a measure of convergence between branches in comparison to alternative metrics. Accordingly, we generated simulated sequences with 500 codons along a balanced phylogenetic tree ending with 32 sequences at the tips (or leaves), in all cases comparing two deeply separated tip lineages (shown as dots in Fig. 1c; Supplementary Table 2). In this analysis, we compared C/D, dNC, dSC and \u03c9C under four evolutionary scenarios of relationships between the two tips being compared: (1) full neutral evolution along all branches (Neutral); (2) neutral evolution for nearly all branches but with convergent selection along the two deeply separated tip lineages (Convergent); (3) neutral evolution with phylogenetic tree topology error in the form of a copy-and-paste transfer from one of the two deeply separated lineages to the other, overwriting its genetic information (Transfer) or (4) neutral evolution but using a randomly reconstructed phylogenetic tree to detect convergence (Random). The metric dNC is obtained by dividing the observed value of non-synonymous convergence (OCN) by the expected value (ECN) and is essentially equivalent to the previously proposed metric called R18, but we use the dNC notation here to clarify its relationship to dSC, the ratio of observed to expected values of synonymous convergence (OCS\u2009/\u2009ECS).", "During neutral evolution, sequences evolved under a constant codon substitution model without any adaptive convergence or constraint on amino acid substitutions other than those imposed by the structure of the genetic code and relative codon frequencies. In the Neutral scenario (Fig. 1c), the trees used for simulation and reconstruction were identical. C/D was much lower than 1.0, as expected, while the other three metrics (dNC, dSC and \u03c9C) were close to but lower than the theoretical expectation of 1.0 (Fig. 1d). This observation is probably due to the fact that the convergent events must be inferred and are not actually observed, as investigated previously for the convergence measure R18. In the Convergent scenario, adaptive convergence on the focal pair of deeply separated branches (red branches in Fig. 1c) was mimicked by convergently evolving 5% of codon sites (25 sites) in the two branches under substitution models biased towards codons encoding the same randomly selected amino acid. This generated an average of four excess non-synonymous convergent substitutions on these two branch pairs (OCN in Fig. 1c). In the Convergent scenario, the three protein convergence metrics, C/D, dNC and \u03c9C, yielded values substantially higher than they did under the Neutral scenario, while the synonymous change measure dSC remained comfortably well below 1.0. Using the distribution of metric values under the Neutral scenario as a reference, we see that 70\u201380% of the detection metric values in the Convergent scenario are above the 95th percentile of the 1,000 simulations in their respective neutral distributions, while only 3.5% of dSC values are above this threshold, indicating that this level of convergence is usually detected by all three of the protein convergence metrics (Fig. 1d). In \u03c9C, this level of detection was achievable with only two to three non-synonymous convergent substitutions, and the positive rates exceeded 95% with seven or more convergent substitutions (Supplementary Fig. 3). To be thorough, we considered that \u03c9C metrics can in general be derived for nine types of combinatorial substitution (that is, substitutions occurring at the same protein site in multiple independent branches; Supplementary Text 2) based on whether the ancestral and descendant states are the same or different, or in any state among multiple branches (Supplementary Fig. 1c). In the Convergent scenario, only the \u03c9C metrics involved in convergence (that is, not divergence) showed a response, confirming its specificity (Supplementary Fig. 4a).", "We next considered Transfer and Random scenarios that include phylogenetic error. In the Transfer scenario, we transferred one of the focal tip sequences to the other focal tip sequence in the simulation, but the phylogenetic tree used in the analysis remained unchanged, as might happen with HGT events (Fig. 1c). In the Random scenario, we fully randomized the entire reconstructed tree relative to the true tree (Fig. 1c). Excess convergence detected in either of these scenarios is considered a false positive. We determined that both C/D and dNC (and thus R too) are sensitive to the errors (Fig. 1d). By contrast, and as intended, \u03c9C values were close to the neutral expectation because the rise in dNC due to phylogenetic error is matched by a similar increase of dSC, and they cancel each other out in the \u03c9C metric (Fig. 1d). Further simulations supported the robustness of \u03c9C against the rate of protein evolution, model misspecification, tree size and protein size (Supplementary Fig. 4b\u2013f). Still, care must be taken when using simple codon substitution models, such as MG and GY models (Supplementary Text 5). Furthermore, \u03c9C showed low false positive rates in sister branches that serve as a control for the focal branch pairs10 (Supplementary Fig. 4g). Taken together, our simulation showed that \u03c9C effectively counteracts false positives caused by phylogenetic errors without loss of power.", "\u03c9C is robust to false convergence in empirical datasets", "To test whether \u03c9C performs well with real data, we collected protein-coding sequence datasets from known molecular convergence events in various pairs of lineages covering insects, tetrapods and flowering plants (Fig. 1e, Supplementary Fig. 5, Supplementary Fig. 6 and Supplementary Table 3). Insects that feed on milkweed (Apocynaceae) harbour amino acid substitutions in a sodium pump subunit (ATPalpha1) that confer cardiac glycoside resistance19\u201321 (Supplementary Fig. 5a). Echolocating bats and whales share amino acid substitutions in the hearing-related motor protein prestin to enable high-frequency hearing22,23 (Supplementary Fig. 5b). An extensive molecular convergence occurred in the mitochondrial genomes of agamid lizards and snakes, presumably due to physiological adaptations for radical fluctuations in their aerobic metabolic rates13. Specialized digestive physiology of herbivorous mammals24\u201326 and carnivorous plants27 led to the molecular convergence of digestive enzymes (Supplementary Fig. 5c\u2013g). Phosphoenolpyruvate carboxylase (PEPC), a key enzyme for carbon fixation in C4 photosynthesis, shares multiple amino acid convergence28,29 (Supplementary Fig. 5h). In all these examples, \u03c9C successfully detected convergent lineages, while it was always lower and in many cases close to the neutral expectation in the branch pairs sister to the focal lineages, which serve as a negative control10 (Fig. 1e and Supplementary Table 4). Moreover, the \u03c9C values of the focal branch pairs tended to be high compared with background levels in the phylogenetic trees (Supplementary Fig. 5i). Analysis of different categories of combinatorial substitutions correctly recovered a trend consistent with the action of intramolecular epistasis, which did not appear in the simulations (Supplementary Text 6 and Supplementary Fig. 5j,k).", "To test robustness against phylogenetic errors, we also employed reported cases of HGTs associated with C4 photosynthesis30 and plant parasitism31. We reconstructed the phylogenetic trees of the HGT genes with a constraint that enforces species tree-like topologies (Supplementary Fig. 7). This operation separates the HGT donor and acceptor lineages and creates false convergence (Supplementary Fig. 1a). Consistent with the simulation results, \u03c9C values in HGTs were lower than the adaptive convergence events (Fig. 1e). By contrast, C/D and dNC showed values higher in HGTs than in the adaptive convergence events. Together with the simulations, these results show that the consideration of synonymous substitutions is essential for the accurate detection of molecular convergence in the presence of phylogenetic error and that \u03c9C outperforms current alternative methods.", "\u03c9C probes a high-confidence set of convergently evolved genes", "Discovering adaptive molecular convergence in genome-scale datasets, which may be translated into genotype\u2013phenotype associations, has been challenging since it is a rare phenomenon and false positives are high10\u201312. To examine whether the application of \u03c9C can generate plausible hypotheses of adaptive molecular convergence, we analysed the 21 vertebrate genomes covering a range from fish to humans (Fig. 2a and Supplementary Fig. 8a) and calculated \u03c9C and other metrics for all independent branch pairs in 16,724 orthogroups classified by OrthoFinder32. CSUBST completed the analysis even for the largest orthogroup (OG0000000) containing 682 genes encoding zinc finger proteins and 901,636 independent branch pairs (alignment length including gaps: 31,665\u2009bp). We obtained a total of 20,150,538 branch pairs from all orthogroups, and subsequent analyses revealed that convergence probability decreased over time probably due to intramolecular epistasis (Fig. 2b, Supplementary Fig. 5l, Supplementary Fig. 8b,c and Supplementary Text 7), that gene duplication also reduced convergence probability (Fig. 2c and Supplementary Text 8) and that \u03c9C is robust for potential artifacts by falsely placed gene duplications and false gene grouping (Supplementary Fig. 8d,e and Supplementary Text 9).Fig. 2Biological variation of \u03c9C in a genome-scale dataset.a, Phylogenetic relationships of the selected species. Supplementary Fig. 8a provides the complete phylogeny. The tree and divergence time estimates were obtained from timetree.org95. b, Temporal variation of convergence rates. The numbers of branch pairs (N) and Spearman\u2019s correlation coefficient (\u03c1) are shown. The bin range was determined to assign an equal number of branch pairs to each bin. To reduce the noise originating from branches where almost no substitutions occurred, branch pairs with both OCN and OCS greater than 1.0 were analysed (that is, at least one convergent substitution each). Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. c, Convergence rates depending on gene duplications. Branch pairs were categorized into speciation events (SS) and branch pairs after two independent gene duplications (DD) according to the presence of preceding gene duplications in no or both branches, respectively. Branch pairs with one preceding duplication were excluded from the analysis. Dashed lines indicate the theoretical expectation (=\u20091.0). Icon credits for panel a: PhyloPic.com.", "Fig. 2Biological variation of \u03c9C in a genome-scale dataset.a, Phylogenetic relationships of the selected species. Supplementary Fig. 8a provides the complete phylogeny. The tree and divergence time estimates were obtained from timetree.org95. b, Temporal variation of convergence rates. The numbers of branch pairs (N) and Spearman\u2019s correlation coefficient (\u03c1) are shown. The bin range was determined to assign an equal number of branch pairs to each bin. To reduce the noise originating from branches where almost no substitutions occurred, branch pairs with both OCN and OCS greater than 1.0 were analysed (that is, at least one convergent substitution each). Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. c, Convergence rates depending on gene duplications. Branch pairs were categorized into speciation events (SS) and branch pairs after two independent gene duplications (DD) according to the presence of preceding gene duplications in no or both branches, respectively. Branch pairs with one preceding duplication were excluded from the analysis. Dashed lines indicate the theoretical expectation (=\u20091.0). Icon credits for panel a: PhyloPic.com.", "Biological variation of \u03c9C in a genome-scale dataset.", "a, Phylogenetic relationships of the selected species. Supplementary Fig. 8a provides the complete phylogeny. The tree and divergence time estimates were obtained from timetree.org95. b, Temporal variation of convergence rates. The numbers of branch pairs (N) and Spearman\u2019s correlation coefficient (\u03c1) are shown. The bin range was determined to assign an equal number of branch pairs to each bin. To reduce the noise originating from branches where almost no substitutions occurred, branch pairs with both OCN and OCS greater than 1.0 were analysed (that is, at least one convergent substitution each). Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. c, Convergence rates depending on gene duplications. Branch pairs were categorized into speciation events (SS) and branch pairs after two independent gene duplications (DD) according to the presence of preceding gene duplications in no or both branches, respectively. Branch pairs with one preceding duplication were excluded from the analysis. Dashed lines indicate the theoretical expectation (=\u20091.0). Icon credits for panel a: PhyloPic.com.", "We first extracted the branch pairs with the top 1% of C/D, dNC or \u03c9C values with a cut-off for a minimum of three non-synonymous and synonymous convergence (OCN\u2009\u2265\u20093.0 and OCS\u2009\u2265\u20093.0) (Fig. 3a). The top 1% threshold allows different convergence metrics to be compared without introducing arbitrary thresholds in each metric. The overlap between each set of branch pairs was moderate, with 1,348 branch pairs satisfying all three criteria out of 5,659 pairs with the top 1% \u03c9C values.Fig. 3Joint convergence of gene expression patterns and protein sequences.a, Comparison of convergent branch pairs obtained by different methods in the vertebrate dataset. Branch pairs with OCN\u2009\u2265\u20093.0 and OCS\u2009\u2265\u20093.0 were analysed. The stochastic equality of the data was tested by a two-sided Brunner\u2013Munzel test with W as the test statistic96. Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. b, A schematic illustration of convergent expression evolution modelled with a multi-optima Ornstein\u2013Uhlenbeck process. c, Venn diagrams showing the extent of overlap between protein and expression convergence. Circles represent the sets of branch pairs. d\u2013g, Examples of the likely adaptive joint convergence. Aldo-keto reductase family 1 (AKR1, d), Nudix hydrolase 16 like 1 (NUDT16L1, e), Myeloid associated differentiation marker (MYADM, f) and dihydrodiol dehydrogenase (DHDH, g) are shown. The silhouettes represent the species (Supplementary Fig. 8a) that carries the gene, and the clades involved in the joint convergence are indicated with an enlarged size. The colours of branches and animal silhouettes indicate expression regimes. Branches involved in joint convergence are highlighted with thick lines, connected by the colour of the expression regime and annotated with convergence metrics. Localization of convergent and divergent substitutions on the protein structure is shown along with a close-up view of functionally important sites. Substrates and their analogues are shown as green sticks. Side chains forming the substrate-binding site are also shown as sticks. Note that these are the side chains in the protein from databases, so amino acid substitutions in the convergent lineages may result in distinct structures and arrangements. Site numbers correspond to those in the Protein Data Bank (PDB) entry or the AlphaFold structure (from d to g: 1Q13, 5W6X, AF-Q6DFR5-F1-model_v2 and 2O48). Icon credits for panels d\u2013g: Rattus norvegicus, Rebecca Groom, under a Creative Commons license CC BY 3.0; Astyanax mexicanus, Milton Tan/PhyloPic under a Creative Commons license CC BY -NC-SA 3.0; all other images are from PhyloPic.com or were created by the author.", "Fig. 3Joint convergence of gene expression patterns and protein sequences.a, Comparison of convergent branch pairs obtained by different methods in the vertebrate dataset. Branch pairs with OCN\u2009\u2265\u20093.0 and OCS\u2009\u2265\u20093.0 were analysed. The stochastic equality of the data was tested by a two-sided Brunner\u2013Munzel test with W as the test statistic96. Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. b, A schematic illustration of convergent expression evolution modelled with a multi-optima Ornstein\u2013Uhlenbeck process. c, Venn diagrams showing the extent of overlap between protein and expression convergence. Circles represent the sets of branch pairs. d\u2013g, Examples of the likely adaptive joint convergence. Aldo-keto reductase family 1 (AKR1, d), Nudix hydrolase 16 like 1 (NUDT16L1, e), Myeloid associated differentiation marker (MYADM, f) and dihydrodiol dehydrogenase (DHDH, g) are shown. The silhouettes represent the species (Supplementary Fig. 8a) that carries the gene, and the clades involved in the joint convergence are indicated with an enlarged size. The colours of branches and animal silhouettes indicate expression regimes. Branches involved in joint convergence are highlighted with thick lines, connected by the colour of the expression regime and annotated with convergence metrics. Localization of convergent and divergent substitutions on the protein structure is shown along with a close-up view of functionally important sites. Substrates and their analogues are shown as green sticks. Side chains forming the substrate-binding site are also shown as sticks. Note that these are the side chains in the protein from databases, so amino acid substitutions in the convergent lineages may result in distinct structures and arrangements. Site numbers correspond to those in the Protein Data Bank (PDB) entry or the AlphaFold structure (from d to g: 1Q13, 5W6X, AF-Q6DFR5-F1-model_v2 and 2O48). Icon credits for panels d\u2013g: Rattus norvegicus, Rebecca Groom, under a Creative Commons license CC BY 3.0; Astyanax mexicanus, Milton Tan/PhyloPic under a Creative Commons license CC BY -NC-SA 3.0; all other images are from PhyloPic.com or were created by the author.", "Joint convergence of gene expression patterns and protein sequences.", "a, Comparison of convergent branch pairs obtained by different methods in the vertebrate dataset. Branch pairs with OCN\u2009\u2265\u20093.0 and OCS\u2009\u2265\u20093.0 were analysed. The stochastic equality of the data was tested by a two-sided Brunner\u2013Munzel test with W as the test statistic96. Box plot elements are defined as follows: centre line, median; box limits, upper and lower quartiles; whiskers, 1.5\u2009\u00d7\u2009interquartile range. b, A schematic illustration of convergent expression evolution modelled with a multi-optima Ornstein\u2013Uhlenbeck process. c, Venn diagrams showing the extent of overlap between protein and expression convergence. Circles represent the sets of branch pairs. d\u2013g, Examples of the likely adaptive joint convergence. Aldo-keto reductase family 1 (AKR1, d), Nudix hydrolase 16 like 1 (NUDT16L1, e), Myeloid associated differentiation marker (MYADM, f) and dihydrodiol dehydrogenase (DHDH, g) are shown. The silhouettes represent the species (Supplementary Fig. 8a) that carries the gene, and the clades involved in the joint convergence are indicated with an enlarged size. The colours of branches and animal silhouettes indicate expression regimes. Branches involved in joint convergence are highlighted with thick lines, connected by the colour of the expression regime and annotated with convergence metrics. Localization of convergent and divergent substitutions on the protein structure is shown along with a close-up view of functionally important sites. Substrates and their analogues are shown as green sticks. Side chains forming the substrate-binding site are also shown as sticks. Note that these are the side chains in the protein from databases, so amino acid substitutions in the convergent lineages may result in distinct structures and arrangements. Site numbers correspond to those in the Protein Data Bank (PDB) entry or the AlphaFold structure (from d to g: 1Q13, 5W6X, AF-Q6DFR5-F1-model_v2 and 2O48). Icon credits for panels d\u2013g: Rattus norvegicus, Rebecca Groom, under a Creative Commons license CC BY 3.0; Astyanax mexicanus, Milton Tan/PhyloPic under a Creative Commons license CC BY -NC-SA 3.0; all other images are from PhyloPic.com or were created by the author.", "To examine which metrics better enrich for likely adaptive convergence, we compared the topological confidence scores of the selected branches. If artifacts due to tree topology errors are included, low confidence branches should be enriched. Analysis of the bootstrap-based confidence values33,34 showed that \u03c9C selects branch pairs with higher confidence than the other two metrics (Fig. 3a). Furthermore, we examined the synonymous convergence rate (dSC), which is not expected to be greater than the theoretical expectation in the adaptive convergence, and established that only \u03c9C satisfies such an assumption (Fig. 3a). These results indicate that \u03c9C has excellent properties for finding adaptive protein convergence in genome-scale analyses.", "Detecting convergent genes associated with a particular phenotype", "As convergence metrics have been used to search for genes associated with phenotypes of interest, we next examined whether \u03c9C might be used to discover candidate genes underlying phenotypic convergence. Here we analysed a pair of herbivorous animal lineages as an example of a search for genes associated with a complex trait (that is, herbivory): ruminants (the stem branch of the clade including cattle (Bos taurus) and red sheep (Ovis aries)) versus rabbits (the terminal branch connected to Oryctolagus cuniculus). Using minimum thresholds for the number of convergent amino acid substitutions (OCN\u2009\u2265\u20093.0) and protein convergence rate (\u03c9C\u2009\u2265\u20093.0), we obtained 352 candidate gene branch pairs corresponding to the above pair of lineages in a genome-scale analysis of the 21 vertebrates (Supplementary Table 5). By mapping the positions of substitutions onto known conformations of homologous proteins, we identified particularly compelling cases of likely adaptive convergence that generated genotypes linked to particular phenotypes (Supplementary Fig. 9). Examples included olfactory receptors in which convergent substitutions are located in the interior of the receptor barrel (Olfactory Receptor Family 7 Subfamily A (OR7A), Olfactory Receptor Family 2 Subfamily M Member 2 (OR2M2) and Olfactory Receptor Family 1 Subfamily B Member 1 (OR1B1), where substitutions may change ligand preference associated with herbivorous behaviour.", "Similarly, the barrel-like structure of some solute carriers harboured convergent substitutions in their interior sides (Solute Carrier Family 5 Member 12 (SLC5A12), SLC51A, SLC22A and SLC44A1), suggesting their involvement in the uptake or transport of plant-derived compounds. Among these, SLC51A (also known as organic solute transporter \u03b1 (OST\u03b1)) may be a particularly attractive candidate. This protein plays a major role in bile acid absorption and, hence, in dietary lipid absorption35. The convergence in SLC51A may be coupled with another convergent event detected in CYP7A1, a cytochrome P450 protein known to serve as a critical regulatory enzyme of bile acid biosynthesis36. Cytochrome P450 Family 7 Subfamily A Member 1 (CYP7A1) harboured two convergent substitutions in its substrate-binding sites (Supplementary Fig. 9). While most herbivores secrete bile acids mainly in a glycine-conjugated form, ruminant bile is mostly in the form of taurine-conjugated bile acids, which remain soluble in highly acidic conditions37. The predominance of taurine-conjugated forms is also observed in rabbits, depending on species and developmental stage38. Thus, convergence in these proteins may be related to such nutritional physiology characteristic in these herbivorous animals.", "Other examples of detected convergence included two convergent substitutions in the DNA-binding sites of a member of the zinc finger protein family, which functions as a transcriptional regulator39 (Supplementary Fig. 9). Convergence in the substrate-binding sites of pancreatic elastase40 and pancreatic DNase I (ref. 41) may be related to their specialized digestion (Supplementary Fig. 9). In DNase I, amino acid sites exposed on the surface of protein structures displayed additional convergent substitutions that change the charge of their target amino acid residues (E124K, G172D and H208N), possibly resulting in convergent changes in the biochemical properties of the protein, such as optimal pH, resistance to proteolysis and post-translational modifications. Consistent with this idea, bovine and rabbit DNase I proteins are known to be more resistant to degradation by pepsin than their homologues in other animals42. Furthermore, E124K was shown to be important for the phosphorylation of bovine DNase I (ref. 43). Other convergent substitutions will be promising candidates for future characterization. Taken together, these results show how our approach can detect genetic changes (for example, molecular convergence in SLC51A, CYP7A1 and DNase I) associated with phenotypes (for example, specialized digestion for herbivory) on the macroevolutionary scale.", "Exploratory analysis of molecular convergence", "We further exploited the 21 vertebrate genomes to examine whether \u03c9C might be used to discover adaptive molecular convergence that may generate hypotheses of linked phenotypes. Because convergence at multiple levels of biological organization can provide strong evidence for adaptive evolution, we searched for simultaneous convergence in protein sequences and gene expression in an exploratory manner without a predefined hypothesis on convergently evolved genes and lineages. Using the same thresholds applied to the analysis of herbivores above (OCN\u2009\u2265\u20093.0 and \u03c9C\u2009\u2265\u20093.0), we obtained 53,805 candidate branch pairs from all orthogroups.", "Although this was an exploratory analysis in which all independent branch pairs were exhaustively analysed, many studies of convergent evolution involve only a few groups of focal species. If such a research design is applied to this dataset (similar to the analysis of herbivores), the number of detected branch pairs will be much smaller. For example, because there are 861 branch pairs in the species tree, on average, 62.5 cases of protein convergence will be obtained in our genome-scale dataset for any particular analysis of two groups of species, although the numbers of analysable branch pairs and hence of detected convergence depend on several factors (Supplementary Text 10 and Supplementary Fig. 10).", "To detect convergent gene expression evolution, we employed the amalgamated transcriptomes for six organs in the 21 vertebrate species44. Using this previously published dataset, we subjected curated gene expression levels (SVA-log-TMM-FPKM, log2-transformed values of fragments per kilobase of exon per million reads mapped, corrected by trimmed mean of M-values and surrogate variable analysis) to multi-optima phylogenetic Ornstein\u2013Uhlenbeck (OU) modelling, in which expression evolution is inferred as regime shifts of estimated optimal expression levels45 (Fig. 3b). Phylogenetic positions and the numbers of expression regime shifts were determined by a LASSO (least absolute shrinkage and selection operator)-based algorithm with Akaike Information Criterion, which was also used for finding convergent shifts towards similar optimal values. In total, we detected 12,017 cases of expression convergence in 4,308 orthogroups. Setting the thresholds for gene expression specificity at \u03c4\u2009\u2265\u20090.67 (ref. 46) and expression levels at \u03bcmax\u2009\u2265\u20092.0 (the maximum value of fitted SVA-log-TMM-FPKM)44, we obtained a set of 2,917 high-confidence branch pairs for potentially adaptive convergence of expression patterns (Fig. 3c).", "By taking the intersection of protein convergence and expression convergence, we discovered 33 cases of potentially adaptive joint convergence of expression patterns and protein sequences in 31 orthogroups (Fig. 3c and Supplementary Table 6). Gene duplication was frequently associated with joint convergence, with at least one branch experiencing gene duplication in 23 out of the 33 branch pairs (P\u2009=\u20093.11\u2009\u00d7\u200910\u221225, \u03c72\u2009=\u2009107.7, \u03c72 test of independence). While gene duplication generally reduced the convergence rate, as discussed earlier (Fig. 2c), some of the independently generated duplicates may tend to evolve into the same sequence space when similar expression evolution takes place. Convergence of testis-specific genes was most frequently observed (19/33 orthogroups) and significantly enriched, with the effect size highest among six tissues (Supplementary Table 7). The mechanism by which the testis serves as a major place for functional evolution of duplicated genes has been explained by several factors, including the ease with which expression is acquired in spermatogenic cells47,48. This phenomenon is called the out-of-the-testis hypothesis, and our results suggest that predictable protein evolution may be enriched in this evolutionary pathway. While adaptive evolution may explain this evolutionary scenario, it is possible that partially relaxed constraints may also be involved in protein convergence, particularly at protein sites that were so constrained that almost no amino acid substitutions occurred before relaxation.", "To infer the functional effect of convergent amino acid substitutions, we mapped the positions of substitutions onto known conformations of homologous proteins. Strikingly, we observed convergently evolved proteins where clusters of substitutions are localized to functionally important sites (Fig. 3d\u2013g and Supplementary Text 11). For example, an orthogroup of dihydrodiol dehydrogenase (DHDH) showed joint convergence of expression and proteins (Fig. 3g). Possible physiological roles of this enzyme included the detoxification of cytotoxic dicarbonyl compounds, such as 3-deoxyglucosone derived from glycation49,50. Although the domain structure of proteins was well conserved among species (Supplementary Fig. 11a), the gene expression patterns of the encoding genes tended to vary. DHDH is known to show distinct tissue-specific expression patterns in mammals: kidney in monkeys (Macaca mulatta)51, kidney and liver in dogs (Canis lupus)52, liver and lens in rabbits53 and various tissues in pigs (Sus scrofa)49. Our amalgamated transcriptomes showed largely consistent species-specific expression patterns (Fig. 3g). The OU analysis recovered four lineage-specific regime shifts categorized into two pairs of convergent expression evolution. One of them, the convergence of gene expression that occurred between frogs (Xenopus) and the blind cave fish (Astyanax), which diverged approximately 435 million years ago54, is characterized by kidney-specific expression. The Xenopus gene ENSXETG00000033613 appeared to have arisen from a more widely expressed ancestral gene after a lineage-specific gene duplication. By contrast, the Astyanax gene ENSAMXG00000005808 may have acquired kidney-specific expression without any detectable duplication. In this branch pair, we detected a protein convergence rate that cannot be explained by neutral evolution alone, with a convergence of five amino acid sites (Supplementary Fig. 11a). These convergent substitutions localized around the active site, while we did not observe such a trend for the double divergence (Fig. 3g). This result suggests that the convergent substitutions may have occurred adaptively to change ancestral catalytic function.", "DHDH has broad substrate specificity for carbonyl compounds. This protein oxidizes trans-cyclohexanediol, trans-dihydrodiols of aromatic hydrocarbons and monosaccharides including D-xylose, while it reduces dicarbonyl compounds, aldehydes and ketones52. Its active site is predominantly formed by hydrophobic residues, suggesting their role in catabolizing aromatic hydrocarbons55,56. Notably, the convergent substitutions in the substrate-binding pocket tended to increase amino acid hydrophobicity (Supplementary Fig. 11b), suggesting that the remodelling of the active site may have led to the acquisition of new substrates, and hence a novel detoxification ability, in Xenopus and Astyanax.", "In summary, \u03c9C was not only robust against phylogenetic errors, outperforming other methods in simulation and empirical data, but also allowed us to discover plausible adaptive convergence from a genome-scale dataset without a pre-existing hypothesis. The genotypes detected by molecular convergence analysis provide opportunities for the phenotypic association, mechanistic assessment and experimental validation in vivo. This holds even if internal branches are involved in a detected convergence event, because most species in the clade will tend to retain the convergent genotypes identified, and most species in the clade will tend to retain the phenotypic change that drove the molecular convergence. Therefore, molecular convergence revealed by our exploratory analysis will provide a basis for understanding overlooked phenotypes that are in common among species in clades descended from branches where the convergent events occurred.", "Heuristic detection of highly repetitive adaptive convergence", "Convergent events observed on even more than two independent lineages are exceptionally good signals of adaptive evolution, if they exist, because three or more combined convergences should be extremely rare in random noise. Conventionally, convergence in more than two branches has been analysed as multiple pairwise comparisons for which there is a prior hypothesis of convergence. The difficulty in analysing higher-order combinatorial substitutions without specific prior hypotheses lies in the need to explore a vast combinatorial space that exponentially expands as the number of branches to be combined (K) increases. For example, an evenly branching tree with 64 tips has 7,359 independent branch pairs (that is, at K\u2009=\u20092), but the number of branch combinations exponentially increases to 333,375 and 6,976,859 in triple (K\u2009=\u20093) and quadruple (K\u2009=\u20094) combinations, respectively, making it impractical to exhaustively search highly repetitive convergence even in a single phylogenetic tree when a hypothesis on focal lineages is unavailable.", "To overcome this limitation, we developed an efficient branch-and-bound algorithm57 that progressively searches for higher-order branch combinations (Fig. 4a and Supplementary Fig. 12a). For the performance evaluation, we used the PEPC tree (Fig. 4b) because it has repeated adaptive convergence for its use in C4 photosynthesis (Fig. 1e). While the exhaustive search required 156\u2009minutes with K\u2009=\u20093 to analyse 307,432 branch combinations using two central processing units (CPUs), our branch-and-bound algorithm required only 21\u2009seconds. At K\u2009=\u20094, the exhaustive search completed within a practical time by using 16 CPUs (46\u2009hours for nearly 8 million combinations) but failed to complete at K\u2009=\u20095 (152 million combinations). By sharp contrast, the heuristic search took about 5\u2009minutes for the entire analysis, of which the higher-order analysis with K ranging from 3 to 6 took only about 1\u2009minute to analyse as few as 390 combinations with two CPUs (Supplementary Table 8).Fig. 4Heuristic search of higher-order branch combinations for adaptive protein convergence.a, Branch-and-bound algorithm for higher-order branch combinations. This method explores the higher-order combinatorial space until there are no more convergent branch combinations. b, The maximum-likelihood phylogenetic tree of PEPCs in flowering plants. The catalytic function of PEPC, which is crucial in C4 photosynthesis, is illustrated. Photographs of representative C4 photosynthetic lineages are shown. The bar indicates 0.1 nucleotide substitutions per nucleotide site. The complete tree is shown in Supplementary Fig. 6. c, Higher-order convergence enriches C4-type PEPCs. The Venn diagrams show the proportion of convergent branch combinations of C4-type and non-C4-type lineages (red and grey, respectively). Branch combinations containing both were included in non-C4. In the phylogenetic trees, convergent branch combinations are shown as edges connecting branches. d, Improvement of the signal-to-noise ratio in higher-order branch combinations. The line graph shows the median values of the total probabilities (OCN and OCS) and the rates (dNC and dSC) of non-synonymous and synonymous convergence in the convergent branch combinations of C4 lineages. Points correspond to branch combinations. Image credits for panel b: Suaeda aralocaspica from ref. 97 and Alternanthera pungens by monkeyjodey under a Creative Commons lincense CC BY 4.0; Fimbristylis littoralis, Supratchai Pimpaeng/Shutterstock; all other images from freepik.com.", "Fig. 4Heuristic search of higher-order branch combinations for adaptive protein convergence.a, Branch-and-bound algorithm for higher-order branch combinations. This method explores the higher-order combinatorial space until there are no more convergent branch combinations. b, The maximum-likelihood phylogenetic tree of PEPCs in flowering plants. The catalytic function of PEPC, which is crucial in C4 photosynthesis, is illustrated. Photographs of representative C4 photosynthetic lineages are shown. The bar indicates 0.1 nucleotide substitutions per nucleotide site. The complete tree is shown in Supplementary Fig. 6. c, Higher-order convergence enriches C4-type PEPCs. The Venn diagrams show the proportion of convergent branch combinations of C4-type and non-C4-type lineages (red and grey, respectively). Branch combinations containing both were included in non-C4. In the phylogenetic trees, convergent branch combinations are shown as edges connecting branches. d, Improvement of the signal-to-noise ratio in higher-order branch combinations. The line graph shows the median values of the total probabilities (OCN and OCS) and the rates (dNC and dSC) of non-synonymous and synonymous convergence in the convergent branch combinations of C4 lineages. Points correspond to branch combinations. Image credits for panel b: Suaeda aralocaspica from ref. 97 and Alternanthera pungens by monkeyjodey under a Creative Commons lincense CC BY 4.0; Fimbristylis littoralis, Supratchai Pimpaeng/Shutterstock; all other images from freepik.com.", "Heuristic search of higher-order branch combinations for adaptive protein convergence.", "a, Branch-and-bound algorithm for higher-order branch combinations. This method explores the higher-order combinatorial space until there are no more convergent branch combinations. b, The maximum-likelihood phylogenetic tree of PEPCs in flowering plants. The catalytic function of PEPC, which is crucial in C4 photosynthesis, is illustrated. Photographs of representative C4 photosynthetic lineages are shown. The bar indicates 0.1 nucleotide substitutions per nucleotide site. The complete tree is shown in Supplementary Fig. 6. c, Higher-order convergence enriches C4-type PEPCs. The Venn diagrams show the proportion of convergent branch combinations of C4-type and non-C4-type lineages (red and grey, respectively). Branch combinations containing both were included in non-C4. In the phylogenetic trees, convergent branch combinations are shown as edges connecting branches. d, Improvement of the signal-to-noise ratio in higher-order branch combinations. The line graph shows the median values of the total probabilities (OCN and OCS) and the rates (dNC and dSC) of non-synonymous and synonymous convergence in the convergent branch combinations of C4 lineages. Points correspond to branch combinations. Image credits for panel b: Suaeda aralocaspica from ref. 97 and Alternanthera pungens by monkeyjodey under a Creative Commons lincense CC BY 4.0; Fimbristylis littoralis, Supratchai Pimpaeng/Shutterstock; all other images from freepik.com.", "The analysed tree covered nine independent origins of C4-type PEPC, and the corresponding branch pairs of C4 lineages accounted for 1.1% of all possible pairs (94/8,308). Convergent branch pairs defined by a threshold (\u03c9C\u2009\u2265\u20095.0 and OCN\u2009\u2265\u20092.0) enriched for the C4 lineages at K\u2009=\u20092 (29.9%, 26/87; Fig. 4c). The convergence of non-C4 lineages (61/87, including pairs of C4 and non-C4 branches) can be interpreted as false positives or adaptive convergence associated with other currently unknown functions. The subsequent higher-order analysis resulted in the discovery of highly repetitive convergence in combinations of as many as six branches (that is, K\u2009=\u20093 to K\u2009=\u20096). As the order increased, the lineages of C4-type PEPCs rapidly predominated and accounted for all the combinations detected at K\u2009\u2265\u20095 (Fig. 4c), even though the heuristic algorithm was not given any information about the C4 lineages.", "In the higher-order C4 branch combinations, the detected convergence events were almost entirely non-synonymous (OCN), while synonymous convergence (OCS) was negligible (Fig. 4d). As a result, the rate of synonymous convergence (dSC) quickly approached zero (Fig. 4d). Notably, the higher-order convergent substitutions were located at functionally important protein sites. In the convergent branch combinations with K\u2009=\u20096, we identified three amino acid sites with a joint posterior probability of non-synonymous convergence greater than 0.5: V627I, H665N, and A780S (Supplementary Fig. 12b\u2013d). The H665N substitution generates a putative N-glycosylation site that may be important for protein folding29. The A780S substitution, for which the signature of positive selection had been detected previously28,58,59, has been shown to change the enzyme kinetics related to the first committed step of C4 carbon fixation60\u201362 and is therefore considered a diagnostic substitution of C4-type PEPC28,29. The third substitution, C627I, might be a good focus for future experimentation. Application of the heuristic search to the 21 animal genomes revealed that while likely adaptive higher-order convergence could be detected, false detections arising from inconsistently represented splicing variants should be carefully avoided when performing genome-scale analyses (Supplementary Text 12, Supplementary Fig. 13 and Supplementary Table 9). Nevertheless, these results demonstrate that higher-order analysis can substantially increase the signal-to-noise ratio in convergence analysis when there is repeated selective pressure to evolve similar biochemical functions."]